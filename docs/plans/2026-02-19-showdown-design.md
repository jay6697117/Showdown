# Showdown — 荒野决斗复刻版 设计方案

## 项目总览

复刻《荒野乱斗》的荒野决斗（Showdown）模式，10 人大逃杀，支持单排/双排。像素风格，Web 端优先，后续可扩展至移动端。

## 技术架构

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 游戏引擎 | Phaser 3 | 2D 渲染、物理碰撞、场景管理 |
| 语言 | TypeScript | 前后端统一语言，类型安全 |
| P2P 通信 | WebRTC DataChannel | 对战中玩家间低延迟直连 |
| 信令服务器 | Node.js + ws | 房间管理、匹配、WebRTC 信令交换 |
| 构建工具 | Vite | 快速开发热更新 |
| 美术风格 | 像素风 (Pixel Art) | 16x16 或 32x32 像素精灵 |
| 音效 | Howler.js | Web 音频播放 |

### 网络模型

- 信令服务器只负责：创建/加入房间、玩家匹配、WebRTC 连接建立
- 对战数据全部走 WebRTC DataChannel P2P 直连
- 房间第一个玩家自动成为 Host，运行游戏逻辑仲裁

---

## 核心游戏机制

### 地图系统
- 地图尺寸：约 40x40 格（每格 32x32 像素），总可视区域 1280x1280
- 地图元素：草丛（隐身）、墙壁（不可穿越/不可破坏）、箱子（可破坏，掉落能量块）、水域（不可通行）
- 2 张预设地图，用 Tiled 编辑器制作，导出 JSON 加载

### 毒圈机制
- 对战开始 30 秒后毒圈开始缩小
- 每 10 秒收缩一次，分 5 个阶段逐步逼近地图中心
- 毒圈外每秒扣除生命值，越后期伤害越高（阶段1: 200/秒 → 阶段5: 1000/秒）

### 能量块系统
- 破坏箱子掉落 1 个能量块，击杀敌人掉落其所有能量块
- 每个能量块 +400 生命上限 +10% 伤害加成
- 单个玩家最多收集 10 个能量块

### 弹药系统
- 每个角色 3 发弹药上限
- 每发弹药自动恢复时间：2 秒
- 攻击消耗 1 发弹药

### 超级技能
- 普攻命中敌人充能（每次命中充 20%，满 100% 可释放）
- 每个角色的超级技能效果不同

### 操作方式（PC 端）
- WASD 移动
- 鼠标瞄准 + 左键射击
- 右键/Q 键释放超级技能

---

## 角色设计

### 1. Gunner（枪手）— 射手型
- 生命值：3200
- 攻击：直线发射 3 发子弹（扇形小角度散射），射程中等
- 伤害：每颗子弹 300（3 颗全中 900）
- 超级技能：向前翻滚冲刺一段距离，冲刺过程中无敌

### 2. Bomber（爆破手）— 投掷型
- 生命值：2800
- 攻击：抛掷炸弹，落点范围爆炸（可越过墙壁）
- 伤害：600（AOE 范围伤害）
- 超级技能：投掷超大炸弹，大范围伤害 + 摧毁墙壁

### 3. Brawler（格斗家）— 近战型
- 生命值：4800
- 攻击：近距离挥拳，扇形范围，射程短
- 伤害：800
- 超级技能：猛冲向前，撞到敌人造成击退 + 伤害（1200）

### 平衡设计

| 角色 | 生命 | 单次伤害 | 射程 | 定位 |
|------|------|---------|------|------|
| Gunner | 中 | 低×3 | 中远 | 消耗/牵制 |
| Bomber | 低 | 中 | 远(抛物线) | 区域控制 |
| Brawler | 高 | 高 | 近 | 突脸/坦克 |

三角克制：Gunner 风筝 Brawler → Brawler 突脸 Bomber → Bomber 隔墙炸 Gunner

---

## 网络架构与对战流程

### 房间生命周期

```
玩家打开游戏 → 连接信令服务器(WebSocket)
  → 创建房间 / 加入房间（房间码）/ 快速匹配
  → 等待 10 人就绪
  → 信令服务器协调所有玩家与 Host 建立 WebRTC 连接
  → 对战开始，信令服务器退出数据转发
  → 对战结束，回到大厅
```

### Host（房主）职责
- 运行游戏核心逻辑：碰撞检测、伤害计算、毒圈推进、死亡判定
- 以固定 20 tick/秒 的频率向所有玩家广播游戏状态快照
- 接收所有玩家的输入指令（移动方向、攻击、技能）

### 客户端（非 Host 玩家）职责
- 发送输入指令给 Host
- 接收状态快照，插值渲染（lerp）让画面平滑
- 本地预测：按下移动后立刻在本地移动角色，收到服务端数据后修正

### 数据包格式

```
玩家输入包（Client → Host）:  ~20 bytes
{ seq, dx, dy, attack, skill, aimX, aimY }

状态快照（Host → All）:  ~500 bytes
{ tick, players: [{ id, x, y, hp, ammo, energy, state }],
  bullets: [{ x, y, dx, dy, owner }],
  zone: { centerX, centerY, radius } }
```

### 断线处理
- 玩家断线 5 秒内可重连，角色原地站立不动
- 超过 5 秒判定淘汰
- Host 断线 → 迁移 Host 到下一个存活玩家（带状态快照转移）

---

## 大厅 UI 与游戏流程

### 页面/场景划分

1. **MainMenu（主菜单）** — 快速匹配 / 创建房间 / 加入房间 / 角色选择
2. **Lobby（等待大厅）** — 显示已加入玩家列表、准备状态、单排/双排切换
3. **Game（对战场景）** — 核心游戏画面
4. **Result（结算画面）** — 排名、击杀数、获得能量块数

### 主菜单界面元素
- 玩家昵称（本地输入，无需注册）
- 三个角色选择卡片（带像素头像 + 属性预览）
- 「快速匹配」按钮 — 自动匹配/创建房间
- 「创建房间」按钮 — 生成 6 位房间码
- 「加入房间」按钮 — 输入房间码加入
- 单排/双排 模式切换开关

### 等待大厅
- 显示 10 个玩家槽位（已加入/空位）
- 双排模式下显示队伍分组（2人一组，共5组）
- 房主可选择地图（2选1）
- 所有人准备后 3 秒倒计时开始

### 对战 HUD
- 左上：存活人数（如 "存活: 7/10"）
- 左下：弹药指示器（3 个弹药槽）
- 角色脚下：血条 + 能量块数量
- 右下：超级技能按钮（充能进度环）
- 右上：小地图（显示毒圈范围、队友位置）

### 结算画面
- 你的排名（#1 - #10）
- 击杀数、造成伤害、收集能量块
- 「再来一局」/ 「返回主菜单」按钮

---

## 项目目录结构

```
Showdown/
├── client/                    # 前端游戏客户端
│   ├── src/
│   │   ├── main.ts            # 入口文件
│   │   ├── config.ts          # 游戏配置常量
│   │   ├── scenes/            # Phaser 场景
│   │   │   ├── MainMenu.ts
│   │   │   ├── Lobby.ts
│   │   │   ├── Game.ts
│   │   │   └── Result.ts
│   │   ├── entities/          # 游戏实体
│   │   │   ├── Player.ts
│   │   │   ├── Bullet.ts
│   │   │   ├── Crate.ts
│   │   │   └── PowerCube.ts
│   │   ├── characters/        # 角色定义
│   │   │   ├── Gunner.ts
│   │   │   ├── Bomber.ts
│   │   │   └── Brawler.ts
│   │   ├── systems/           # 游戏系统
│   │   │   ├── ZoneManager.ts     # 毒圈
│   │   │   ├── CombatSystem.ts    # 战斗计算
│   │   │   └── InputManager.ts    # 输入处理
│   │   ├── network/           # 网络层
│   │   │   ├── SignalingClient.ts  # WebSocket 信令
│   │   │   ├── PeerManager.ts     # WebRTC 连接管理
│   │   │   ├── HostLogic.ts       # Host 端游戏逻辑
│   │   │   └── ClientSync.ts      # 客户端插值/预测
│   │   ├── ui/                # UI 组件
│   │   │   ├── HUD.ts
│   │   │   ├── MiniMap.ts
│   │   │   └── AmmoBar.ts
│   │   └── assets/            # 静态资源
│   │       ├── sprites/
│   │       ├── maps/
│   │       └── audio/
│   ├── index.html
│   ├── package.json
│   └── vite.config.ts
├── server/                    # 信令服务器
│   ├── src/
│   │   ├── index.ts           # 服务器入口
│   │   ├── RoomManager.ts     # 房间管理
│   │   ├── Matchmaker.ts      # 匹配逻辑
│   │   └── SignalingHandler.ts # WebRTC 信令处理
│   ├── package.json
│   └── tsconfig.json
└── shared/                    # 前后端共享
    ├── types.ts               # 共享类型定义
    ├── constants.ts           # 共享常量
    └── protocol.ts            # 通信协议定义
```

---

## 开发阶段规划

| 阶段 | 内容 | 说明 |
|------|------|------|
| Phase 1 | 单机核心玩法：地图渲染、角色移动射击、箱子破坏、能量块、毒圈、AI 敌人 | 基础阶段 |
| Phase 2 | 3 个角色差异化实现 + 超级技能 + 战斗平衡 | 角色阶段 |
| Phase 3 | 信令服务器 + WebRTC P2P 连接 + Host 逻辑 + 状态同步 | 联网阶段 |
| Phase 4 | 大厅 UI + 房间系统 + 匹配 + 双排模式 | 联网 UI 阶段 |
| Phase 5 | HUD、小地图、结算画面、音效、打磨体验 | 打磨阶段 |

建议从 Phase 1 开始，先在本地跑通一个单人 + AI 的完整对战，再叠加联网。
